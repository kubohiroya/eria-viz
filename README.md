# react-gadm-select

ひとつめのWebアプリは、GeoJSONデータをWebブラウザのIndexedDBへ格納する作業を実施します。

1. ユーザがWebブラウザで、以降の処理をするためのデータを入力します。次のようなデータです。
  * 「GeoJSONをダウロードできるURL」を、textareaに入力された文字列を改行記号で分割してリストとして示したもの
  * ポリゴンを構成する点の座標を丸める精度(緯度経度の小数点以下を一定の桁数までとして四捨五入する)
  * ポリゴンやポリゴンの穴を省略する場合の面積の閾値(座標を丸めてポリゴンを簡略化した後にそのポリゴンおよびポリゴンの穴の面積を求めて、閾値以下であればそのポリゴンやポリゴンの穴を省略する)
  * 保存先データベース名

2. ユーザがWebブラウザからtextareaに入力した改行付きテキスト内容を、URLのリストとして、それらのダウンロードを試みます。ダウンロードできなかったものがあれば、その情報をまとめた警告をダイアログで表示します。そうでなければ3に進みます。

3. URLからダウンロードされた内容を、GADMが配布する国・行政区画のシェイプデータのGeoJSONフォーマット形式のファイルであるものとして解釈を試みます。解釈に失敗したものがあれば、その情報をまとめた警告をダイアログで表示します。そうでなければ4に進みます。

4. GeoJSONデータについて、ユーザの指定した内容に基づいて簡略化します。
  * まず、ポリゴンを構成する点の座標を丸めます。
  * その後、ポリゴンの定義において同じ点が連続するものとなった箇所については、冗長な点を削除します。
  * 次に、ポリゴンやポリゴンの穴の面積が一定以下のものを削除します。

5. 簡略化されたGeoJSONデータについて、そのシェイプのバウンディングボックスが属するマップタイルについて、ズームレベル2から7までの間で、ズームレベル数値/x座標数値/y座標数値　という表示領域検索用文字列を作成します。
6. 簡略化されたGeoJSONの内容を、保存先として指定したデータベース名のIndexedDBに、Dexie.jsを用いて保存します。このとき、次のパラメータで検索できるように、インデックスを作成します。
* 国名
* 行政区画名
* ズームレベル2の表示検索用文字列
* ズームレベル3の表示検索用文字列
* ズームレベル4の表示検索用文字列
* ズームレベル5の表示検索用文字列
* ズームレベル6の表示検索用文字列
* ズームレベル7の表示検索用文字列

# react-indexed-geojson-viewer

WebブラウザのIndexedDBへ格納されたGeoJSONデータを、MapLibre JSで表示した地図上に重ね合わせて描画するコードです。
このとき、MapLibre JSで表示中のズームレベルと表示範囲に応じて、必要最小限のGeoJSONデータをIndexedDBから抽出してメモリ上に保持して描画します。
